%% CDOSR_CanSat.sty
%% Version 2.0 (2025)
%% 
%% Core style file for CoderDojo Oradea Space Robotics CanSat Competition
%% 
%% CHANGELOG:
%% v2.0 (2025-03-11): Reorganized code, modularized style system
%% v1.0 (2023-03-30): Initial version

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{CDOSR_CanSat}[2025/03/11 v2.0 CanSat Competition PDF Style]

%% ============================================================================
%% PACKAGE DEPENDENCIES
%% ============================================================================

% Core packages
\RequirePackage{amsmath, amsfonts, amssymb, amsthm, graphicx}
\RequirePackage[margin=1in]{geometry}
\RequirePackage{multicol}

% Document structure
\RequirePackage{fancyhdr}
\RequirePackage{hyperref}
\RequirePackage{cleveref}
\RequirePackage{titlesec}
\RequirePackage{tocloft}

% Visual elements
\RequirePackage[table,xcdraw,usenames,dvipsnames,x11names]{xcolor}


\RequirePackage{svg}
\RequirePackage{titlesec, lettrine, textcase, relsize}
\RequirePackage{fix-cm}
\RequirePackage[most]{tcolorbox}
\RequirePackage{enumitem}
\RequirePackage{helvet}
\RequirePackage{array, adjustbox, colortbl}
\RequirePackage{siunitx}
\RequirePackage{hyperref}
\RequirePackage{endnotes,lipsum}
\RequirePackage{hyperendnotes}
\RequirePackage{tabularx}
\RequirePackage{wrapfig}
\RequirePackage{tocloft}
\RequirePackage{pifont}
\RequirePackage{fontawesome5}
\RequirePackage{tikz}
\RequirePackage{colortbl}
\RequirePackage{zref-savepos}
\RequirePackage{xifthen} % Required for \isempty test
\RequirePackage{ulem}
\RequirePackage{pdflscape}
\fontfamily{phv}\selectfont

%% ============================================================================
%% COLOR DEFINITIONS
%% ============================================================================

% Define a consistent color palette
\definecolor{CDOSRPrimary}{RGB}{0, 103, 149}     % DeepSkyBlue4
\definecolor{CDOSRSecondary}{RGB}{224, 246, 253} % LightCyan1
\definecolor{CDOSRAccent}{RGB}{192, 0, 0}        % Red
\definecolor{CDOSRText}{RGB}{51, 51, 51}         % Dark gray for text
\definecolor{CDOSRBackground}{RGB}{242, 242, 242} % Light gray for backgrounds

% Provide aliases for backward compatibility
\colorlet{DeepSkyBlue4}{CDOSRPrimary}
\colorlet{LightCyan1}{CDOSRSecondary}
\definecolor{gray}{rgb}{0.60, 0.60, 0.60}
\definecolor{dgray}{rgb}{0.40, 0.40, 0.40}

%% ============================================================================
%% HYPERREF CONFIGURATION
%% ============================================================================

% Configure hyperref with consistent styling
\hypersetup{
  colorlinks=true,
  linkcolor=CDOSRPrimary,
  filecolor=CDOSRPrimary,
  urlcolor=CDOSRPrimary,
  citecolor=CDOSRPrimary,
  pdftitle={CanSat Competition Report},
  pdfauthor={CoderDojo Oradea Space Robotics},
  pdfsubject={CanSat Report},
  pdfkeywords={CanSat, Space, Robotics, Satellite, Education}
}

%% ============================================================================
%% LAYOUT SETTINGS
%% ============================================================================

% Adjust the font size of the table of contents
\renewcommand{\cftsubsecfont}{\small}
\renewcommand{\cftsubsubsecfont}{\small}

% Define section and subsection formatting
\titleformat{\section}[block]{\Large\filcenter\textsc}{\thesection}{1em}{\scshape}
\titleformat{\subsection}[block]{\large\textsc}{\thesubsection.}{1em}{\scshape}
\titleformat{\subsubsection}[block]{\large\textsc}{\thesubsubsection.}{1em}{\scshape}

\renewcommand{\thefigure}{\arabic{section}.\arabic{figure}}

% Set page style
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L,R]{\thepage}
\fancyhead[R]{\textbf{\leftmark}}
\fancyhead[LO]{\textbf{\rightmark}}

% Plain page style (for first pages of chapters)
\fancypagestyle{plain}{%
  \fancyhf{}%
  \renewcommand{\headrulewidth}{0pt}% Remove header rule
  \renewcommand{\footrulewidth}{0pt}% Remove footer rule
  \fancyhead[L]{\includegraphics[scale=0.15]{img_CDOSR.png}}
  \fancyhead[C]{\raisebox{1.5\height}{\centerheadtext}}
  \fancyhead[R]{\includegraphics[scale=0.016]{img_CANSAT_RO.png}}
  \fancyhead[C]{\HruleCanSat[CDOSRPrimary]{5pt}{-15pt}{1.5pt}}
  \fancyfoot[C]{\HruleCanSat[CDOSRPrimary]{5pt}{2pt}{1.5pt}\includegraphics[scale=0.115]{images/template/img_Cansats_in_europe.png}}
  \fancyfoot[R]{\textbf{\thepage}}%
}

\AtBeginDocument{
  \pagestyle{empty}
}

%% ============================================================================
%% BASIC COMMANDS
%% ============================================================================

\newcommand{\righttext}{\textbf{Romanian CanSat and \\Rocketry Competition}}
\newcommand{\centerheadtext}{\textbf{CoderDojo Oradea Space Robotics - PDR}}

\renewcommand{\title}[1]{\def\@title{#1}}
\renewcommand{\author}[1]{\def\@author{#1}}
\renewcommand{\date}[1]{\def\@date{#1}}

\newcommand{\HruleCanSat}[4][.]{%
  \par\addvspace{#2}%
  \begingroup\color{#1}%
  \hrule height #4
  \endgroup
  \addvspace{#3}%
}

\newcommand{\cansattitle}[3]{%
  \begin{titlepage}
      \begin{center}
        \vspace*{1cm}
        \Huge{\textbf{#1}}

        \vspace{4.5cm}
        \includegraphics[width=0.4\textwidth]{#2}%
        \ifthenelse{\isempty{#3}}{}{%
          \hspace{1cm}
          \includegraphics[width=0.4\textwidth]{#3}%
        }

      \end{center}
      \vspace{4.5cm}
      {\LARGE{\textbf{Team Name: CoderDojo Oradea Space Robotics}}}\\[0.3cm]
      {\LARGE{\textbf{Organisation: CoderDojo Oradea}}}\\[0.3cm]
      {\LARGE{\textbf{Country: Romania}}}
    
      \vspace{0.5cm}
      \begin{flushright} 
        \textbf{\@date}
      \end{flushright}
    \end{titlepage}
}

\newcommand{\cansatstyle}{
  \setlength{\headheight}{36.58205pt}
  \addtolength{\topmargin}{-24.58205pt}
}

%% ============================================================================
%% PATH MANAGEMENT
%% ============================================================================

% Set default image paths
\graphicspath{{images/}{images/template/}{images/diagrams/}{images/photos/}{icons/}{images/cdr/}{images/pdr/}}

% Command to set custom image paths
\newcommand{\setcansatimagepaths}[1]{%
  \graphicspath{#1}
}

% Load additional modules if available
\IfFileExists{./styles/CDOSR_Tables.sty}{\RequirePackage{./styles/CDOSR_Tables}}{}
\IfFileExists{./styles/CDOSR_Figures.sty}{\RequirePackage{./styles/CDOSR_Figures}}{}
\IfFileExists{./styles/CDOSR_Math.sty}{\RequirePackage{./styles/CDOSR_Math}}{}
\IfFileExists{./styles/CDOSR_Lists.sty}{\RequirePackage{./styles/CDOSR_Lists}}{}
\IfFileExists{./styles/CDOSR_Boxes.sty}{\RequirePackage{./styles/CDOSR_Boxes}}{}
\IfFileExists{./styles/CDOSR_Bibliography}{\RequirePackage{./styles/CDOSR_Bibliography}}{}
\IfFileExists{./styles/CDOSR_Draft}{\RequirePackage{./styles/CDOSR_Draft}}{}